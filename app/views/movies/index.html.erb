<h1>Chuck Norris Movies!</h1>

<div class="movies-index">

  <div style="padding-bottom: 10px;">
    <p style="display: inline;">Sort movies by:</p>
    <select>
      <option value="date" selected="selected">release date</option>
      <option value="title">title</option>
      <option value="genre">genre</option>
    </select>
  </div>

  <div style="filter-movies">
    <label>Filter by title
      <input class="filter-input" type="text">
    </label>
  </div>

  <ul class="main-list list-group"></ul>

  <script class="template" type="text/template">
    <%% movies.forEach(function (movie) { %>
      <li class="list-group-item"
        data-title="<%%= movie.title %>"
        data-date="<%%= movie.release_date %>"
        data-genre="<%%= genreCodes[movie.genre_ids[0]] %>">
        <a href="/movies/<%%= movie.id %>">
          <h3><%%= movie.title %></h3>
          <p style="color: black; margin-left: 2px;"><%%= movie.release_date %></p>
          <img class="" width="200" src="http://image.tmdb.org/t/p/w396/<%%= movie.poster_path %>">
        </a>
        <p class="text-muted" style="padding-top: 10px;"><%%= genreCodes[movie.genre_ids[0]] %></p>
      </li>
    <%% }); %>
  </script>
</div>

<script type="text/javascript">
  $(function() {
    $('div.movies-index').moviesIndex();
  });

  var $filterInput = $('input.filter-input');
  $filterInput.on('keyup', function (e) {
    var input = $filterInput.val();
    if (input !== '') {
      filterMovies(input);
    } else {
      showAll();
    }
  });
  var filterMovies = function (substring) {
    var $movieItems = $('ul.main-list').children();
    $movieItems.each(function (i, movie) {
      var $movie = $(movie);
      var title = $movie.attr('data-title');
      if (title.indexOf(substring) > -1) {
        $movie.removeClass('hide');
      } else {
        $movie.addClass('hide');
      }
    });
  };
  var showAll = function () {
    var $movieItems = $('ul.main-list').children();
    $movieItems.each(function (i, movie) {
      $(movie).removeClass('hide');
    });
  };
</script>
